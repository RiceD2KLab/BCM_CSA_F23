# BCM_CSA_F23

## Description
The project outlines a comprehensive study on Central Sleep Apnea (CSA), aiming to identify cost-effective predictive features and establish a new diagnostic threshold that could potentially save lives and healthcare costs. The team utilized the Sleep Heart Health Study dataset and implemented machine learning techniques for data analysis, feature selection, and model optimization.

The study revealed the Ridge model as the most efficient for predicting CSA with a Mean Absolute Error of 4.6. Key predictive features included Body Mass Index, neck and waist circumferences, and health interview responses related to lifestyle choices. Moreover, the current CSA diagnostic threshold (CAHI > 5) was challenged, suggesting a lower threshold (CAHI > 2) to enhance diagnostic sensitivity.

The project emphasizes the potential of data science in healthcare, advocating for more accessible sleep testing methods, thus reducing the financial burden on patients and healthcare facilities. The findings could prompt a reassessment of CSA classification criteria, facilitating earlier and more accurate diagnoses.

The success of this study could influence other healthcare domains, leveraging data science to challenge and improve existing diagnostic standards. The team acknowledges the support of the National Heart Lung and Blood Institute and the contributions of the Sleep Heart Health Study.

## Project Goals
 - Predict central sleep apnea using a less invasive and less expensive   procedure
 - Explore which of the variables contribute most to the mortality
 - Determine if a small CAHI leads to increased mortality risk, and if  
   so, lower the  threshold of diagnosis of CSA to more appropriately   
   capture this risk.

## How to Use
### Source Code

 - All our code is located in `./src`. Most of our experiments are located in `./src/notebooks/`. 
 - The models generated from both the    objectives are in  `./models/threhsold` and    `./models/cheap_features`.

 - The logs from the threshold fine tuning experiments are in    `./results`, these are generated by hydra. (We use hydra to explore different configurations of models, datasets, and thresholds for finding the best one). 
 - The data is located in `./data`.
 - For more infomration on the folder structure look at the [Directory structure](#directory-structure) section.

## Installation
`conda create -n csa python=3.9`

`pip install -r requirements.txt`

### Generating results for Initial Experiment
`python classify.py --multirun dataset=shhs1 model=logistic_regression,svc,random_forest target=ahi_a0h3a,ahi_a0h4`

`python regression.py --multirun dataset=shhs1 model=linear_regression,ridge,lasso,knn,svr target=ahi_a0h3a,ahi_a0h4`

### Generating results for the Threshold experiments

`python3 ./src/models/find_threshold.py --multirun dataset=feature_selection_dt,feature_selection_mi,feature_selection_rf,feature_selection_bs,feature_selection_mrmr10,feature_selection_mrmr20,feature_selection_fs_AIC,feature_selection_fs_BIC model=logistic_regression,svc,random_forest,decision_tree,xgboost target=hf15 threshold_cahi=threshold_1,threshold_2,threshold_3,threshold_4,threshold_5,threshold_6,threshold_7,threshold_8,threshold_9 threshold_c_o=threshold_1,threshold_2,threshold_3,threshold_4,threshold_5`

## Directory structure

```nohighlight
├── LICENSE
├── README.md               <- The top-level README for developers using this project.
├── data
│   ├── interim             <- Intermediate data that has been transformed.
│   ├── processed           <- The final, canonical data sets for modeling.
│   └── raw                 <- The original, immutable data dump.
│
│
├── models                  <- Trained and serialized models, model predictions, or model summaries
│   ├── threshold           <- Trained models during finding the Threshold for Central Sleep Apnea diagnosis experiments.
│   └── cheap_features      <- Trained models during finding cheap features to predict Central Sleep Apnea Index.
|

│
├── references              <- Data dictionaries, manuals, and all other explanatory materials.
│
├── reports                 <- Generated analysis as HTML, PDF, LaTeX, etc.
│   └── figures             <- Generated graphics and figures to be used in reporting
│
├── requirements.txt        <- The requirements file for reproducing the analysis environment, e.g.
│                               generated with `pip freeze > requirements.txt`
│
├── src                     <- Source code for use in this project.
│   ├── __init__.py         <- Makes src a Python module
│   │
|   ├── conf                <- Config folder for storing Hydra configurations.
|   │   ├── dataset         <- Configuration folder stating the dataset
|   │   ├── model           <- Configuration folder stating the model
|   │   ├── features        <- Configuration folder stating the features.
|   │   ├── target          <- Configuration folder stating the target.
|   │   ├── threshold_cahi  <- Configuration folder stating the threshold of CSA (CSA>i).
|   │   ├── threshold_c_o   <- Configuration folder stating the threshold of the fraction of OSA (CSA>1/i*OSA).
|   │   ├── config_threshold.yaml        <- File stating the defaults for the threshold experiments.
|   │   └── config.yaml     <- File stating the initial experiment defaults.
|   │ 
|   ├── notebooks           <- Jupyter notebooks. 
|   |
│   ├── models               <- Scripts to train models and then use models to make
│   │   │                 predictions
│   │   ├── classify.py         <- Script to run the classification experiments.
│   |   ├── find_threshold.py   <- Script to run the threshold experiments.
|   |   └── regression.py       <- Script to run the regression experiments.
|   |
|   ├── utils               <- Directory containing Python modules for various custom routines.
|   |   ├── data_exploration.py  <- Utils to calculate metrics used in data exploration.
|   |   ├── feature_selection.py <- Utils containing feature selection methods.
|   |   ├── modeling.py          <- Utils containing modeling methods.
|   |   ├── preprocessing.py     <- Utils used to preprocess (wrangling + cleaning) the dataset(s).
|   |   ├── threshold_logs.py    <- Utils used to generate output logs for threshold analysis.
|   |   └── visualization.py     <- Utils used to generate visualizations from our analysis.

```

## Configuration

We harness Hydra for dynamic configuration to enhance the project's adaptability. The config.yaml sets the default application parameters, while other files like config_threshold.yaml provide specific settings for threshold experiments. For more read this [README.md](./src/conf/README.md)

## Src/Notebooks

This folder contains Jupyter notebooks used for data exploration, preprocessing, feature selection, and result analysis. The description of the files in this folder and their descriptions can be found in this [README.md](./src/notebooks/README.md)

### Src/Utils

This folder contains utility functions used in the notebooks.
